<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Gerador SOAP — Emagrecimento (Via Única + Prescrição)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --brand:#2563eb; --ink:#0f172a; }
    .card { background:#fff; border-radius:18px; box-shadow: 0 12px 30px rgba(2,6,23,.06); }
    .label { font-size:12px; color:#334155; font-weight:600; letter-spacing:.02em }
    .input { width:100%; padding:.7rem .9rem; border:1px solid #e2e8f0; border-radius:12px; }
    .btn  { padding:.8rem 1rem; border-radius:12px; font-weight:700; }
    .btn-primary{ background:var(--brand); color:#fff; }
    .btn-ghost { border:1px solid #e2e8f0; background:#fff; }
    .mono { white-space:pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 13px; line-height:1.35 }
    @media print {
      @page { size: A4 portrait; margin: 14mm; }
      .no-print { display:none !important; }
      .print-only { display:block !important; }
    }
    .print-only { display:none; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">
  <main class="max-w-6xl mx-auto p-6">
    <header class="no-print mb-6 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="./logo.png" class="w-9 h-9 rounded-lg ring-1 ring-slate-200" alt="SannoMed">
        <div>
          <h1 class="text-2xl font-bold tracking-tight">Gerador SOAP — Emagrecimento</h1>
          <p class="text-xs text-slate-500">Via única (A4 retrato) + prescrição</p>
        </div>
      </div>
      <div class="hidden md:flex gap-2 text-sm text-slate-600">
        <span><strong>IMC:</strong> <span id="imcVal">—</span></span>
      </div>
    </header>

    <!-- Formulário -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <form id="formPront" class="card p-6 space-y-5">
        <h2 class="text-lg font-semibold">Prontuário — Via única</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <label class="label">#Data automática
            <input type="date" name="dataConsulta" id="dataConsulta" class="input">
          </label>
          <label class="label">#Nome do paciente
            <input name="nome" class="input" placeholder="Nome completo" value="LAILA JANAINA">
          </label>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
          <label class="label">Peso (kg)
            <input type="number" step="0.1" name="peso" id="peso" class="input" placeholder="65" value="65">
          </label>
          <label class="label">Altura (m)
            <input type="number" step="0.01" name="altura" id="altura" class="input" placeholder="1.69" value="1.69">
          </label>
          <div class="label">IMC
            <div class="input bg-slate-50"><span id="imcBadge">—</span></div>
          </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
          <label class="label">#Comorbidade
            <input name="comorbidade" class="input" placeholder="NEGA ou descrever" value="Nega">
          </label>
          <label class="label">#Alergias
            <input name="alergias" class="input" placeholder="NEGA ou descrever" value="Nega">
          </label>
          <label class="label">#MUC
            <input name="muc" class="input" placeholder="Medicações em uso correntes" value="Nega">
          </label>
        </div>

        <div class="grid grid-cols-1 gap-3">
          <label class="label">#S:
            <textarea name="S" rows="4" class="input" placeholder=""></textarea>
          </label>
          <label class="label">#O:
            <textarea name="O" rows="5" class="input">BEG, LOC, AAA
AC: RCR 2T BNF SS | AP: MV+ bilat., sem ruídos adventícios
Abdome: RHA+, depressível, sem dor
Neuro: sem déficits focais</textarea>
          </label>
          <label class="label">#P:
            <textarea name="P" rows="7" class="input">Prescrevo.
Oriento prática regular de atividade física. Evitar jejum prolongado e bebidas
açucaradas e aumentar ingesta hídrica.
Explico sobre fisiologia dos medicamentos, explico sobre possíveis efeitos
colaterais associados.
Alerto sobre sinais de alarme: dor abdominal intensa, náuseas persistentes,
vômitos, icterícia, palpitações, hipotensão, hipoglicemia — se presentes,
buscar avaliação médica.</textarea>
          </label>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 pt-1">
          <button type="button" id="btnSalvarImprimir" class="btn btn-primary w-full">Salvar & Imprimir (via única SOAP + via única Prescrição)</button>
          <button type="button" id="btnCopiarTexto" class="btn btn-ghost w-full">Copiar somente o texto SOAP</button>
        </div>
      </form>

      <div class="card p-6">
        <h3 class="text-lg font-semibold mb-2">Pré-visualização</h3>
        <pre id="previewSOAP" class="mono min-h-[260px] p-3 border border-slate-200 rounded-xl">Preencha e clique em “Salvar & Imprimir”.</pre>
        <div class="mt-4">
          <h4 class="font-semibold mb-1">Prescrição (prévia)</h4>
          <pre id="previewRX" class="mono min-h-[120px] p-3 border border-slate-200 rounded-xl">Use a máscara abaixo para montar a prescrição e depois clique em "Adicionar à prescrição".</pre>
        </div>
      </div>
    </section>

    <!-- Máscara simples de Prescrição -->
    <section class="mt-8 card p-6 space-y-4 no-print">
      <h2 class="text-lg font-semibold">Máscara de Prescrição</h2>
      <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
        <label class="label">Medicamento
          <select id="med" class="input">
            <option value="wegovy">Wegovy (semaglutida)</option>
            <option value="mounjaro">Mounjaro (tirzepatida)</option>
          </select>
        </label>
        <label class="label">Apresentação
          <select id="apres" class="input">
            <option value="wg-0.25">Wegovy 0,25 mg (pen)</option>
            <option value="wg-0.5">Wegovy 0,5 mg (pen)</option>
            <option value="wg-1.0">Wegovy 1 mg (pen)</option>
            <option value="wg-1.7">Wegovy 1,7 mg (pen)</option>
            <option value="wg-2.4">Wegovy 2,4 mg (pen)</option>
            <option value="mj-2.5">Mounjaro 2,5 mg/dose</option>
            <option value="mj-5">Mounjaro 5 mg/dose</option>
            <option value="mj-7.5">Mounjaro 7,5 mg/dose</option>
            <option value="mj-10">Mounjaro 10 mg/dose</option>
          </select>
        </label>
        <label class="label">Dose/sem (mg)
          <input type="number" step="0.05" id="doseSem" class="input" placeholder="ex.: 0.5">
        </label>
        <label class="label">Nº de doses (Mounjaro)
          <input type="number" min="1" step="1" id="nDoses" value="4" class="input">
        </label>
        <label class="label">Multiplicadores Wegovy
          <input id="wgMult" class="input" value="1,1,2,2,4">
        </label>
      </div>
      <div class="flex gap-3">
        <button type="button" id="btnCalcMask" class="btn btn-primary">Calcular / Gerar texto</button>
        <button type="button" id="btnAddRX" class="btn btn-ghost">Adicionar à prescrição</button>
      </div>
    </section>

    <!-- Área de impressão ÚNICA: SOAP + Prescrição, uma vez cada -->
    <section id="printArea" class="print-only">
      <div style="display:flex; gap:12px; align-items:flex-start">
        <img src="./logo.png" alt="SannoMed" style="height:56px">
        <div>
          <h2 style="margin:0;font-weight:800;">Consulta de Emagrecimento — Via única (SOAP)</h2>
          <div style="font-size:12px;color:#334155">
            Dra. Laila Janaína dos Santos — CRM-SC 38237 • SannoMed Clínica Integrada • Rua Otto Júlio Malina, 671 • Tel: (48) 3034-3735 • contato@sannomed.com.br
          </div>
        </div>
      </div>
      <pre id="outSOAP" class="mono" style="margin-top:8px"></pre>
      <hr style="margin:16px 0;border:none;border-top:1px solid #e2e8f0"/>
      <h2 style="margin:0 0 6px 0;font-weight:800;">Prescrição — Via única</h2>
      <pre id="outRX" class="mono"></pre>
    </section>
  </main>

  <script>
    // Auto-data + IMC
    (function init(){
      const dataEl = document.getElementById('dataConsulta');
      const today = new Date();
      const iso = new Date(today.getTime() - (today.getTimezoneOffset()*60000)).toISOString().slice(0,10);
      dataEl.value = iso;
      const peso = document.getElementById('peso');
      const altura = document.getElementById('altura');
      function updateIMC(){
        const p = parseFloat(peso.value); const a = parseFloat(altura.value);
        let imc = NaN;
        if (p>0 && a>0) imc = p/(a*a);
        const text = isFinite(imc) ? imc.toFixed(1) : '—';
        document.getElementById('imcVal').textContent = text;
        document.getElementById('imcBadge').textContent = text;
      }
      peso.addEventListener('input', updateIMC);
      altura.addEventListener('input', updateIMC);
      updateIMC();
    })();

    function formToObj(form){ return Object.fromEntries(new FormData(form).entries()); }
    function buildSOAP(d){
      return `#Data: ${d.dataConsulta||''}
#Nome do paciente: ${d.nome||''}
#Comorbidade: ${d.comorbidade||'NEGA'}
#Alergias: ${d.alergias||'NEGA'}
#MUC: ${d.muc||''}
#Peso: ${d.peso||''} | #Altura: ${d.altura||''} | #IMC: ${(d.peso&&d.altura)?(parseFloat(d.peso)/(parseFloat(d.altura)**2)).toFixed(1):''}
#S:
${d.S||''}
#O:
${d.O||''}
#P:
${d.P||''}`;
    }

    const previewSOAP = document.getElementById('previewSOAP');
    const previewRX = document.getElementById('previewRX');
    const outSOAP = document.getElementById('outSOAP');
    const outRX = document.getElementById('outRX');
    const formPront = document.getElementById('formPront');

    let lastRX = ''; // guarda a prescrição montada

    document.getElementById('btnSalvarImprimir').addEventListener('click', () => {
      const data = formToObj(formPront);
      const soap = buildSOAP(data);
      previewSOAP.textContent = soap;
      outSOAP.textContent = soap;
      outRX.textContent = lastRX || '—';
      window.print();
    });
    document.getElementById('btnCopiarTexto').addEventListener('click', async () => {
      const data = formToObj(formPront);
      const soap = buildSOAP(data);
      await navigator.clipboard.writeText(soap);
      alert('Texto SOAP copiado!');
    });

    // Lógica máscara simples (Wegovy/Mounjaro) para gerar bloco de prescrição
    const BASE_CLICK_0_25 = { "wg-0.25":75, "wg-0.5":37, "wg-1.0":19, "wg-1.7":11, "wg-2.4":8 };
    const LABELS_WG = { "wg-0.25":"0,25mg", "wg-0.5":"0,5mg", "wg-1.0":"1mg", "wg-1.7":"1,7mg", "wg-2.4":"2,4mg" };

    function buildWegovy(apres, multStr){
      const base = BASE_CLICK_0_25[apres];
      const labelDose = LABELS_WG[apres];
      const mults = (multStr||'1,1,2,2,4').split(',').map(s=>parseFloat(s.trim())).filter(n=>!isNaN(n)&&n>0);
      const weeks = (mults.length?mults:[1,1,2,2,4]).map((m,i)=>`Na semana ${i+1} aplicar ${Math.round(base*m)} cliques`).join('\n');
      return `USO SUBCUTÂNEO
1. Wegovy ${labelDose} (Semaglutida) - 1Cx
Aplicar por via subcutânea, 1x por semana, sempre no mesmo dia. 
${weeks}
Local de aplicação cerca de 4 dedos da cicatriz umbilical, alternando os locais de aplicação`;
    }

    function buildMounjaro(label, nDoses){
      const d = (label||'').replace('Mounjaro ','').replace(' mg/dose','').trim();
      const dosePretty = d.replace(' ','');
      const n = Math.max(1, parseInt(nDoses||'4',10));
      return `USO SUBCUTÂNEO
1. Mounjaro ${dosePretty}mg - 1CX
Aplicar por via subcutânea, 1x por semana, sempre no mesmo dia (${n} doses) 
Local de aplicação cerca de 4 dedos da cicatriz umbilical, alternando os locais de aplicação`;
    }

    document.getElementById('btnCalcMask').addEventListener('click', () => {
      const med = document.getElementById('med').value;
      const apres = document.getElementById('apres').value;
      const mult = document.getElementById('wgMult').value;
      const nD = document.getElementById('nDoses').value;
      let text = '';
      if (med==='wegovy'){ text = buildWegovy(apres, mult); }
      else {
        const label = document.getElementById('apres').selectedOptions[0].textContent;
        text = buildMounjaro(label, nD);
      }
      previewRX.textContent = text;
    });

    document.getElementById('btnAddRX').addEventListener('click', () => {
      const txt = previewRX.textContent.trim();
      if (!txt){ alert('Gere o texto da prescrição primeiro.'); return; }
      lastRX = txt;
      alert('Prescrição adicionada à via de impressão!');
    });
  </script>
</body>
</html>
